<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Status - MeatLizard AI Platform</title>
    <link href="/static/css/meatlizard.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <meta http-equiv="refresh" content="30">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="mascot">ðŸ¦Ž</div>
        <h1>MEATLIZARD AI PLATFORM</h1>
        <div class="subtitle">System Status & Health</div>
    </header>

    <!-- Navigation -->
    <nav>
        <a href="/">Home</a> |
        <a href="/features">Features</a> |
        <a href="/docs">Docs</a> |
        <a href="/status" class="active">Status</a> |
        <a href="/login">Login</a>
    </nav>

    <!-- Main Content -->
    <main>
        <h2>System Status</h2>
        <p class="text-center">
            Real-time status of all MeatLizard platform services. Page refreshes automatically every 30 seconds.
        </p>

        <!-- Overall Status -->
        <div class="card text-center">
            <div class="card-header">
                <i class="fas fa-heartbeat"></i> Overall System Status
            </div>
            <div style="font-size: 2em; margin: 20px 0;">
                <span id="overallStatus" class="status-online">
                    <i class="fas fa-check-circle"></i> All Systems Operational
                </span>
            </div>
            <p>Last updated: <span id="lastUpdated">Loading...</span></p>
        </div>

        <!-- Service Status -->
        <h2>Service Status</h2>
        <div class="card-grid">
            <!-- Web Service -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-globe"></i> Web Service
                </div>
                <div class="text-center">
                    <div id="webStatus" class="status-online">
                        <i class="fas fa-check-circle"></i> Operational
                    </div>
                    <p>Response Time: <span id="webResponseTime">--</span>ms</p>
                    <p>Uptime: <span id="webUptime">--</span></p>
                </div>
            </div>

            <!-- AI Chat -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-robot"></i> AI Chat Service
                </div>
                <div class="text-center">
                    <div id="aiStatus" class="status-warning">
                        <i class="fas fa-exclamation-triangle"></i> Checking...
                    </div>
                    <p>Active Sessions: <span id="activeSessions">--</span></p>
                    <p>Model: <span id="currentModel">--</span></p>
                </div>
            </div>

            <!-- Database -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-database"></i> Database
                </div>
                <div class="text-center">
                    <div id="dbStatus" class="status-online">
                        <i class="fas fa-check-circle"></i> Operational
                    </div>
                    <p>Connections: <span id="dbConnections">--</span></p>
                    <p>Query Time: <span id="dbQueryTime">--</span>ms</p>
                </div>
            </div>

            <!-- Redis Cache -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-memory"></i> Redis Cache
                </div>
                <div class="text-center">
                    <div id="redisStatus" class="status-online">
                        <i class="fas fa-check-circle"></i> Operational
                    </div>
                    <p>Memory Usage: <span id="redisMemory">--</span></p>
                    <p>Hit Rate: <span id="redisHitRate">--</span>%</p>
                </div>
            </div>

            <!-- File Storage -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-hdd"></i> File Storage
                </div>
                <div class="text-center">
                    <div id="storageStatus" class="status-online">
                        <i class="fas fa-check-circle"></i> Operational
                    </div>
                    <p>Disk Usage: <span id="diskUsage">--</span>%</p>
                    <p>Available: <span id="diskAvailable">--</span>GB</p>
                </div>
            </div>

            <!-- Discord Bots -->
            <div class="card">
                <div class="card-header">
                    <i class="fab fa-discord"></i> Discord Bots
                </div>
                <div class="text-center">
                    <div id="discordStatus" class="status-warning">
                        <i class="fas fa-exclamation-triangle"></i> Checking...
                    </div>
                    <p>Server Bot: <span id="serverBotStatus">--</span></p>
                    <p>Client Bot: <span id="clientBotStatus">--</span></p>
                </div>
            </div>
        </div>

        <!-- Performance Metrics -->
        <h2>Performance Metrics</h2>
        <div class="card">
            <div class="card-header">
                <i class="fas fa-chart-line"></i> System Performance
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Current</th>
                        <th>24h Average</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>API Response Time</td>
                        <td id="apiResponseTime">--</td>
                        <td id="apiResponseTimeAvg">--</td>
                        <td><span id="apiResponseStatus" class="status-online">Good</span></td>
                    </tr>
                    <tr>
                        <td>AI Inference Time</td>
                        <td id="aiInferenceTime">--</td>
                        <td id="aiInferenceTimeAvg">--</td>
                        <td><span id="aiInferenceStatus" class="status-online">Good</span></td>
                    </tr>
                    <tr>
                        <td>Database Query Time</td>
                        <td id="dbQueryTimeCurrent">--</td>
                        <td id="dbQueryTimeAvg">--</td>
                        <td><span id="dbQueryStatus" class="status-online">Good</span></td>
                    </tr>
                    <tr>
                        <td>Error Rate</td>
                        <td id="errorRate">--</td>
                        <td id="errorRateAvg">--</td>
                        <td><span id="errorRateStatus" class="status-online">Low</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Recent Incidents -->
        <h2>Recent Incidents</h2>
        <div class="card">
            <div class="card-header">
                <i class="fas fa-exclamation-triangle"></i> Incident History
            </div>
            <div id="incidentHistory">
                <div class="alert alert-success">
                    <strong>No recent incidents</strong> - All systems have been running smoothly.
                </div>
            </div>
        </div>

        <!-- Maintenance Schedule -->
        <h2>Scheduled Maintenance</h2>
        <div class="card">
            <div class="card-header">
                <i class="fas fa-calendar"></i> Upcoming Maintenance
            </div>
            <div id="maintenanceSchedule">
                <p>No scheduled maintenance at this time.</p>
            </div>
        </div>

        <!-- Subscribe to Updates -->
        <div class="card text-center">
            <h3>Stay Updated</h3>
            <p>Get notified about system status changes and maintenance windows.</p>
            <div>
                <a href="/api/status/subscribe" class="retro-button">Subscribe to Updates</a>
                <a href="/api/status/rss" class="retro-button">RSS Feed</a>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        &copy; 2024 MeatLizard Systems | Powered by raw meat and GPUs
    </footer>

    <script>
        // Status checking functionality
        let statusData = {};

        async function checkSystemStatus() {
            try {
                const response = await fetch('/api/system/status');
                if (response.ok) {
                    statusData = await response.json();
                    updateStatusDisplay();
                } else {
                    showError('Failed to fetch status data');
                }
            } catch (error) {
                console.error('Error fetching status:', error);
                showError('Connection error');
            }
        }

        function updateStatusDisplay() {
            // Update timestamp
            document.getElementById('lastUpdated').textContent = new Date().toLocaleString();

            // Update overall status
            const overallHealthy = statusData.overall_status === 'healthy';
            const overallEl = document.getElementById('overallStatus');
            if (overallHealthy) {
                overallEl.className = 'status-online';
                overallEl.innerHTML = '<i class="fas fa-check-circle"></i> All Systems Operational';
            } else {
                overallEl.className = 'status-offline';
                overallEl.innerHTML = '<i class="fas fa-exclamation-circle"></i> Some Issues Detected';
            }

            // Update individual services
            updateServiceStatus('web', statusData.web_service || {});
            updateServiceStatus('ai', statusData.ai_service || {});
            updateServiceStatus('db', statusData.database || {});
            updateServiceStatus('redis', statusData.redis || {});
            updateServiceStatus('storage', statusData.storage || {});
            updateServiceStatus('discord', statusData.discord || {});

            // Update performance metrics
            updatePerformanceMetrics(statusData.performance || {});
        }

        function updateServiceStatus(service, data) {
            const statusEl = document.getElementById(`${service}Status`);
            if (!statusEl) return;

            if (data.status === 'healthy' || data.status === 'operational') {
                statusEl.className = 'status-online';
                statusEl.innerHTML = '<i class="fas fa-check-circle"></i> Operational';
            } else if (data.status === 'degraded' || data.status === 'warning') {
                statusEl.className = 'status-warning';
                statusEl.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Degraded';
            } else {
                statusEl.className = 'status-offline';
                statusEl.innerHTML = '<i class="fas fa-times-circle"></i> Offline';
            }

            // Update specific metrics for each service
            if (service === 'web') {
                updateElement('webResponseTime', data.response_time || '--');
                updateElement('webUptime', data.uptime || '--');
            } else if (service === 'ai') {
                updateElement('activeSessions', data.active_sessions || '--');
                updateElement('currentModel', data.current_model || '--');
            } else if (service === 'db') {
                updateElement('dbConnections', data.connections || '--');
                updateElement('dbQueryTime', data.query_time || '--');
            } else if (service === 'redis') {
                updateElement('redisMemory', data.memory_usage || '--');
                updateElement('redisHitRate', data.hit_rate || '--');
            } else if (service === 'storage') {
                updateElement('diskUsage', data.disk_usage || '--');
                updateElement('diskAvailable', data.available_gb || '--');
            } else if (service === 'discord') {
                updateElement('serverBotStatus', data.server_bot || '--');
                updateElement('clientBotStatus', data.client_bot || '--');
            }
        }

        function updatePerformanceMetrics(performance) {
            updateElement('apiResponseTime', performance.api_response_time || '--');
            updateElement('apiResponseTimeAvg', performance.api_response_time_avg || '--');
            updateElement('aiInferenceTime', performance.ai_inference_time || '--');
            updateElement('aiInferenceTimeAvg', performance.ai_inference_time_avg || '--');
            updateElement('dbQueryTimeCurrent', performance.db_query_time || '--');
            updateElement('dbQueryTimeAvg', performance.db_query_time_avg || '--');
            updateElement('errorRate', performance.error_rate || '--');
            updateElement('errorRateAvg', performance.error_rate_avg || '--');
        }

        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }

        function showError(message) {
            const overallEl = document.getElementById('overallStatus');
            overallEl.className = 'status-offline';
            overallEl.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
        }

        // Initialize status checking
        checkSystemStatus();
        
        // Auto-refresh every 30 seconds
        setInterval(checkSystemStatus, 30000);
    </script>
</body>
</html>